---
layout: post
title: 'Redux 를 넘어 SWR 로(2)'
date: 2020-10-05 00:10
tags: [react, swr]
description: 
draft: false
---

본 시리즈 글은 개인적으로 Redux 를 이용한 상태관리를 줄 곧 해오다가 SWR을 만나고, 프로젝트에서 Redux 의존성 모듈을 완전히 제거하기 까지 이른 과정과 경험을 공유하고자 작성되었습니다.

앞서 첫번째 글에서는 Redux 를 사용할 때 일반적으로 경험할 수 있는 몇가지 문제들을 언급하였습니다. 이 글에서는 SWR 은 무엇이고 SWR 이 어떻게 Redux 를 대체할 수 있는 지에 대해 설명합니다.


### SWR은 무엇인가?
SWR은 Nextjs 로 유명한 vercel 에서 만든 원격데이터 fetch 를 위한 커스텀 훅 모듈입니다. SWR은 원격의 상태를 가져와서 리액트 컴포넌트에 제공하는 기능을 제공합니다.

SWR 의 간단한 사용방법은 댜음과 같습니다.

```js
import useSWR from 'swr'

function Point(){
  const {data, error} = useSWR('/api/points', url => {
    fetch(url).then(res => res.json())
  })
  
  if(error){
    return <div>failed to load</div>
  }
  if(!data){
    return <div>Loading..</div>
  }
  return <div>{data}</div>
}
```

1. useSWR 은 첫번째 인자로 원격상태에 대한 key 를, 두번째 인자로 데이터를 fetch 하는 함수를 받습니다.
1. 첫번째 인자는 두번째 fetch 함수의 첫번째 인자로 전달됩니다.
1. fetch 함수가 데이터를 로드하면 해당 응답이 data 로 세팅되고 오류 발생시 해당 오류가 error 에 세팅됩니다.
1. 컴포넌트에서는 상황에 맞게 결과를 렌더링 합니다.

아주 직관적이고 사용하기도 편하죠 😄

여기서 주목해야 할 부분은 useSWR 은 한번 fetch 한 원격상태의 데이터를 내부적으로 캐시하고 다른 컴포넌트에서 동일한 상태를 사용하고자 할 경우 캐시했던 상태를 그대로 리턴해 주기 때문에 서로 다른 컴포넌트가 동일한 상태를 공유할 수 있다는 점입니다.

서로 다른 컴포넌트가 동일한 상태를 공유한다? 이 부분은 기존의 상태관리 라이브러리들이 하는 역할과 비슷합니다. 우리는 이때 SWR 을 조금 응용해 보면 기존 상태관리 라이브러리가 하던 역할을 완전히 대체할 수 있지 않을까 하는 기대를 걸어볼 수 있습니다.

이제부터 그 기대가 어떻게 그대로 현실이 될 수 있는 지 보여드리도록 하겠습니다.


### 프론트엔드 개발자의 반복적인 루틴

프론트엔드 개발의 대부분의 작업은 아마도 원격 서버의 상태를 UI로 표현하는 일일 것입니다. 이 일을 하기 위해 우리는 먼저 로컬 스토어 상태를 정의하고 각 화면의 컴포넌트들이 상태에 따라 어떻게 반응할지(react) 정의합니다.

그리고 적절한 시점에 원격 서버의 데이터를 fetch 하여 로컬 스토어 상태를 초기화하며 사용자 액션을 받아서 원격상태를 추가/수정/삭제합니다. 그리고 원격상태가 변경될 때마다 그에 맞게 로컬 스토어 상태도 동기화시키는 작업을 빼먹지 말아야 겠지요.

우리 대부분은 늘 이런 일들을 합니다. 이 중 특별히 귀찮은 작업 중 하나가 데이터의 추가/수정/삭제가 발생할 때마다 원격의 상태와 로컬의 상태를 동기화시키는 일이죠. 이 작업에 대한 현기증을 누구나 한번쯤은 느끼셨을 것입니다.

### SWR이 해결하는 문제

SWR 이 해결하고자 하는 문제의 핵심은 바로 이 지점에 있습니다. SWR은 원격상태와 로컬상태를 하나로 통합합니다. SWR이 원격상태의 데이터 스트림을 리액트 컴포넌트에 그대로 연결한다고 생각하셔도 좋습니다. 위에 제시된 코드를 다시 한번 보세요. 정말로 SWR이 그 역할을 매끄럽게 해내고 있지 않습니까?

SWR은 개발자가 해당 데이터를 마치 원격상태와 연결된 데이터 스트림으로서 바라볼 수 있도록 데이터 fetching 단계를 추상화합니다. 여기서 눈치빠른 개발자라면 SWR 이 어떻게 실시간으로 원격서버의 상태를 실시간 데이터 스트림으로 얻을 수 있단 말이냐 라고 의문을 가지실 수 있습니다. 네 당연한 의문입니다. 그 비밀을 살짝 이야기 드리자면 (매우 시시하지만) SWR 은 내부적으로 적절한 타이밍에 데이터를 폴링합니다. 그래서 사실 실시간이라는 용어를 사용하기에는 민망스러울 만큼 사실 실시간으로 데이터가 fetch 되는 것은 아닙니다. 하지만 충분히 용납할 수 있는 수준으로 데이터는 최신 데이터로 갱신됩니다. SWR 은 브라우져 창이 focus 를 얻을 때 또는 네트워크가 offline 에서 online 으로 바뀔 때 자동으로 데이터를 fetch 합니다. 그 밖에 polling 주기를 직접 설정하는 것도 가능합니다.  

### SWR은 어떻게 리덕스를 대체할 수 있는가
SWR 이 기존 Redux 를 대체할 수 있는 이유는 컴포넌트간 전역 상태를 공유할 수 있다는 특성 때문입니다. 로컬 스토어의 대부분 상태는 아마 원격 서버의 상태를 그대로 저장해 둔 것에 다르지 않을 것입니다.




SWR 가 Redux 의 모든 기능을 대체할 수는 없을 것이라 생각하지는 않습니다. 2가지는 해결하고자하는 문제 자체가 다릅니다.



### SWR은 어떻게 리덕스의 단점을 극복하는가


(작성 중..)

