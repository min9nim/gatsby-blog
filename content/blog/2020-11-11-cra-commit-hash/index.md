---
layout: post
title: '[js] `e` 를 이용한 숫자표기법이 필요한 이유'
date: 2020-11-11 00:10
tags: [js, number, float]
description: 자바스크립트는 문법적으로 여러가지 애매한 특징들을 가지고 있다. 특별히 소수점 처리가 범상치 않다는 것은 이미 대충은 알고 있을 것이다. 왜 유독 14 에 0.1 을 곱할 경우만 결과가 이상하게 떨어지는 걸까? 위 문제가 현실 세계에서 어떤 문제를 발생시킬 수 있을 지 직접 예시를 통해 확인해 보자.
draft: false
---

자바스크립트는 문법적으로 여러가지 애매한 특징들을 가지고 있다. 특별히 소수점 처리가 범상치 않다는 것은 이미 널리 알려진 사실이다.

```html{4-5}
13 * 0.1
> 1.3

14 * 0.1
> 1.4000000000000001

15 * 0.1
> 1.5

14 / 10
> 1.4
```

왜 유독 `14` 에 `0.1` 을 곱할 경우만 결과가 이상하게 떨어지는 걸까? 위 문제가 현실 세계에서 어떤 문제를 발생시킬 수 있을 지 직접 예시를 통해 확인해 보자.


### 현실 세계 문제
특정 소수점 자리에서 반올림하는 함수를 아래와 같이 정의했다고 해보자.

```js
function round(num, offset = 0){
  const mul = Math.pow(10, offset > 0 ? 1 - offset : -offset)
  return Math.round(num / mul) * mul
}
```

일반적인 경우에는 기대했던 데로 잘 동작하는 것 같다.

```
round(10.2)
> 10

round(10.257, 3)
> 10.26

round(10.257, 2)
> 10.3

round(10.2577424, 5)
> 10.2577

round(1324, -2)
> 1300
```

하지만 아래와 같은 예외 케이스가 곧 등장한다.  

```js
round(1.423, 2)
> 1.4000000000000001
```

내부적으로 `14 * 0.1` 연산이 수행되면서 앞서 소개되었던 에지 케이스에 정확히 걸려 들었다. 😱

`round` 함수가 위와 같은 경우에도 정확하게 `1.4` 를 리턴하도록 하려면 어떻게 해야할까? 🤔


### `e` 표기법의 등장

자바스크립트에는 자주 사용되지 않지만 `e` 를 이용한 숫자표기법이 있다. 쓰임새는 아래와 같다.

```
14e2
> 1400

14e1
> 140

14e0
> 14

14e-1
> 1.4
```

어떤 녀석인지 대충 감이 오지 않는가? 바로 이 `e` 표기법을 사용하면 왠지 우리의 문제를 쉽게 해결해 줄 수 있을 것 같다.

`e` 를 사용하여 `round` 함수를 아래와 같이 수정해 보자.

```js
function round(num, offset = 0){
  const e = (num, p) => Number(num + 'e' + p)
  const pos = offset > 0 ? offset - 1 : offset
  return e(Math.round(e(num, pos)), -pos)
}
```

이제야 기대했던 결과가 정확히 떨어졌다.

```js
round(1.423, 2)
> 1.4
```

오늘은 자바스크립트에서 `e` 표기법이 필요한 이유를 알았다.🙂
